# Проект AP01 - Архитектурное видение

## Обзор проекта

AP01 представляет собой комплексную систему аудиообработки, построенную на базе Qt Framework и предназначенную для работы с аудиосигналами в реальном времени. Система состоит из нескольких взаимодействующих компонентов, каждый из которых выполняет специализированные функции.

## Архитектура системы

### Общая архитектура

Система построена по модульной архитектуре с центральным управляющим компонентом (BandMaster) и несколькими специализированными модулями:

```
┌─────────────────┐    UDP    ┌─────────────────┐
│   BandMaster    │◄─────────►│    Recorder     │
│   (GUI + Core)  │           │   (Audio Rec)   │
└─────────────────┘           └─────────────────┘
         │                             
         │ UDP                         
         ▼                             
┌─────────────────┐           ┌─────────────────┐
│   PSGenerator   │           │    SPlayer      │
│  (Signal Gen)   │           │  (Audio Play)   │
└─────────────────┘           └─────────────────┘
         │                             
         │ UDP                         
         ▼                             
┌─────────────────┐           ┌─────────────────┐
│     VoDec       │           │     Correl      │
│ (Voice Detect)  │           │ (Correlation)   │
└─────────────────┘           └─────────────────┘
```

### Компоненты системы

#### 1. BandMaster (Центральный управляющий модуль)
- **Назначение**: Главное приложение с графическим интерфейсом для управления всей системой
- **Технологии**: Qt Widgets, Qt Network, Qt Multimedia
- **Архитектурные особенности**:
  - Паттерн MVC с разделением на GUI и бизнес-логику
  - Система диспетчеризации команд (BM_dispatcher)
  - Фабрика обработчиков (BM_hfactory)
  - Машина состояний для управления процессами
  - Мастер-классы для управления каждым типом модулей

#### 2. Recorder (Модуль записи аудио)
- **Назначение**: Захват и запись аудиосигналов с различных источников
- **Технологии**: Qt Multimedia, Qt Network
- **Функциональность**:
  - Многоканальная запись аудио
  - Буферизация данных (a_buffer)
  - Сохранение в WAV формате
  - Конфигурируемые параметры записи (частота дискретизации, разрядность)

#### 3. PSGenerator (Генератор псевдослучайных сигналов)
- **Назначение**: Генерация тестовых аудиосигналов
- **Технологии**: Qt Core, Qt Network, libdspl
- **Функциональность**:
  - Генерация многочастотных сигналов
  - Настраиваемая длительность и частоты
  - Сохранение сгенерированных сигналов

#### 4. SPlayer (Аудиоплеер)
- **Назначение**: Воспроизведение аудиофайлов
- **Технологии**: Qt Multimedia, Qt Network
- **Функциональность**:
  - Воспроизведение WAV файлов
  - Управление уровнем громкости
  - Выбор устройства вывода

#### 5. VoDec (Детектор голоса)
- **Назначение**: Анализ аудиосигналов и детекция голосовой активности
- **Технологии**: Qt Core, Qt Network, Eigen (математическая библиотека), libdspl
- **Функциональность**:
  - Алгоритмы детекции голоса
  - Анализ артефактов сигнала
  - Обработка временных буферов

#### 6. Correl (Модуль корреляционного анализа)
- **Назначение**: Корреляционный анализ сигналов
- **Технологии**: Qt Core, libdspl
- **Функциональность**:
  - Вычисление корреляционных функций
  - Анализ сходства сигналов

## Система сборки

### Инструменты сборки
- **Основной инструмент**: qmake (Qt Build System)
- **Компилятор**: MinGW 64-bit (Windows), GCC (Linux)
- **Стандарт C++**: C++17/C++20 (в зависимости от модуля)

### Структура сборки
```
build/
├── debug/          # Отладочные сборки
│   ├── bandmaster/
│   ├── recorder/
│   ├── psgenerator/
│   ├── splayer/
│   ├── vodec/
│   └── correl/
└── release/        # Релизные сборки
    └── [аналогичная структура]
```

### Конфигурационные файлы
- **common.pri**: Общие настройки для всех модулей
- **app.pri**: Настройки для исполняемых файлов
- **ap01.pro**: Главный файл проекта (TEMPLATE = subdirs)

### Пути размещения
- **Исходный код**: `src/`
- **Объектные файлы**: `build/[debug|release]/[module]/obj/`
- **MOC файлы**: `build/[debug|release]/[module]/moc/`
- **UI файлы**: `build/[debug|release]/[module]/ui/`
- **Исполняемые файлы**: `bin/[debug|release]/`

## Используемые библиотеки и зависимости

### Основные библиотеки
1. **Qt Framework** (версия 6.5.1)
   - Qt Core: Базовая функциональность
   - Qt Widgets: Графический интерфейс
   - Qt Network: Сетевое взаимодействие
   - Qt Multimedia: Работа с аудио

2. **libdspl-2.0** (Digital Signal Processing Library)
   - Библиотека цифровой обработки сигналов
   - FFT, фильтрация, корреляция
   - Математические функции для DSP

3. **Eigen 3.4.0**
   - Библиотека линейной алгебры
   - Используется в модуле VoDec для математических вычислений

4. **AudioFile.h** (внешняя библиотека)
   - Работа с аудиофайлами (WAV, AIFF)
   - Чтение и запись аудиоданных

5. **ini.h** (внешняя библиотека)
   - Парсинг INI конфигурационных файлов
   - Управление настройками приложений

### Системные зависимости
- **Windows**: Visual Studio 2022 Community (для некоторых заголовков)
- **Linux**: GCC с поддержкой C++20

## Взаимодействие компонентов

### Протокол связи
Все модули взаимодействуют через **UDP протокол** с использованием собственного формата сообщений:

```cpp
struct AMSGData {
    uint32_t unitID;    // ID модуля
    uint32_t msgID;     // ID сообщения
    uint32_t reqID;     // ID запроса (для подтверждений)
    uint32_t msgCode;   // Код операции/команды
    QDateTime moment;   // Временная метка
    QString msgArg;     // Аргументы команды
    QString msgTxt;     // Описание операции
};
```

### Система команд
Используется enum-based система кодов команд:
- **BM_command**: Команды управления (Start, Pause, Stop, Status, SetOption1-5)
- **BM_uState**: Состояния модулей (Processing, Stand_by, Result_saved, etc.)

### Конфигурация
Каждый модуль имеет свой INI файл конфигурации:
- `bmhfactory.ini`: Конфигурация BandMaster и список модулей
- `conf_GEN_0_1100.ini`: Настройки генератора сигналов
- `conf_REC_A_1102.ini`: Настройки записи аудио
- `conf_PLR__1104.ini`: Настройки плеера
- `conf_VOD_0_1112.ini`: Настройки детектора голоса

## Архитектурные решения

### 1. Модульность
- Каждый компонент - отдельное приложение
- Слабая связанность через UDP протокол
- Возможность независимого развития модулей

### 2. Асинхронность
- Неблокирующее взаимодействие между модулями
- Система подтверждений сообщений
- Таймеры для повторной отправки

### 3. Конфигурируемость
- Внешние INI файлы для всех настроек
- Динамическая загрузка конфигурации
- Возможность изменения параметров без перекомпиляции

### 4. Расширяемость
- Фабрика обработчиков для добавления новых типов модулей
- Единый интерфейс взаимодействия
- Система плагинов через динамические библиотеки

### 5. Отказоустойчивость
- Система логирования для каждого модуля
- Обработка ошибок сети и устройств
- Механизм повторных попыток

## Особенности реализации

### Буферизация данных
Используется кольцевой буфер (`Rbuffer`) для эффективной работы с потоковыми данными:
```cpp
template <typename T, std::size_t m_size> 
class Rbuffer {
    // Реализация кольцевого буфера с предикатами поиска
};
```

### Обработка сигналов
Интеграция с libdspl для:
- Быстрого преобразования Фурье (FFT)
- Цифровой фильтрации
- Корреляционного анализа
- Генерации тестовых сигналов

### Многопоточность
- Qt's event-driven архитектура
- Сигналы и слоты для межпоточного взаимодействия
- Таймеры для периодических операций

## Заключение

Проект AP01 представляет собой хорошо структурированную систему для работы с аудиосигналами, построенную на современных принципах архитектуры ПО. Модульная структура обеспечивает гибкость и расширяемость, а использование проверенных библиотек гарантирует надежность и производительность системы.

Система подходит для задач:
- Исследования и анализа аудиосигналов
- Тестирования аудиооборудования
- Обработки речевых сигналов
- Образовательных целей в области DSP

---
*Документ создан на основе анализа исходного кода проекта AP01*
